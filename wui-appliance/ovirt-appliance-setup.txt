This document describes basic setup steps for getting your Ovirt WUI appliance
running.  It assumes you've either downloaded the appliance from
http://ovirt.org, or that you've built an equivalent appliance locally using
the wui-appliance kickstart file.  The default root password for the
appliance is 'ovirtwui' (no quotes); you'll want to change that as soon as
possible.

-----------------------------------------------------------------------------
Network configuration
-----------------------------------------------------------------------------
If you haven't yet done it, you'll need to make some modifications
to get it on the network.  We strongly suggest giving it a static IP address;
this will make sure that the DNS name for the host is stable, which is
important for FreeIPA to work properly.  The easiest way to do this is to
run:

# system-config-network

As root, and fill in your appropriate configuration.  After this is done,
you'll want to reboot to make sure that your IP address and hostname get
setup properly.

-----------------------------------------------------------------------------
PXE configuration
-----------------------------------------------------------------------------
If you downloaded the pre-built appliance, you can skip this step.  If you
built the appliance from the kickstart file, you'll need to download the Ovirt
PXE host image that the physical machines will use to boot up.  This is
available as a tarball from http://ovirt.org/downloads.  Once you've downloaded
the tarball, run (as root):

# mv /tftpboot /tftpboot.old
# tar -C / -jxvf ovirt-pxe-host-image-<version>.tar.bz2
# service xinetd restart

This should explode the PXE host image into /tftpboot, and restart xinetd
so it notices the changes.

-----------------------------------------------------------------------------
Site-specific configuration
-----------------------------------------------------------------------------
From here on out, we will assume that you are logged on as root, since most
of these steps require root access.  There are a number of steps necessary
to get things up and running, so let's get started:

1)  First, we need to setup dhcpd on this server, since this will act as
the DHCP server for all of the Ovirt host machines.  You can start with the
following as an example:

-------------------------<cut here>----------------------------------------
allow booting;
allow bootp;
ddns-update-style interim;
ignore client-updates;

option iscsi-servers code 200 = array of ip-address;
option ovirt-tftp-server code 201 = ip-address;
option libvirt-auth-method code 202 = text;
option collectd-server code 203 = ip-address;

subnet 192.168.25.0 netmask 255.255.255.0 {
        option domain-name "redhat.com";
        option domain-name-servers 172.16.76.10,172.16.76.20;
        next-server 192.168.25.2;
        option routers 192.168.25.1;
        option iscsi-servers 192.168.25.1;
        option ovirt-tftp-server 192.168.25.2;
        option collectd-server 192.168.25.2;
        option libvirt-auth-method "krb5:192.168.25.2";
        range 192.168.25.3 192.168.25.250;
        filename "pxelinux.0";
}
-------------------------<cut here>----------------------------------------

Make sure to replace all of the relevant domain names, IP address, subnets, etc.
to match your setup.  All of these really need to be right for anything to
work properly; for more information, read the file
ovirt-appliance-dhcpd-conf.txt.

2)  # chkconfig dhcpd on ; service dhcpd restart

3)  Next we need to setup the FreeIPA (http://freeipa.org) server.  This is
the heart of the authentication and encryption system that Ovirt utilizes.
You should run:

# /usr/sbin/ipa-server-install

This will ask you a number of questions; the page at:
http://www.freeipa.com/page/InstallAndDeploy

can give you more details about what the questions mean.  Remember your
realm name; it will be very important later on.

Server host name [perf2.perf.redhat.com]: You can usually accept the default,
       	    	 			  unless it says localhost.localdomain.
					  You'll need to make sure that the IP
					  address you are using for the server
					  resolves to a stable DNS name.

Please provide a realm name [PERF.REDHAT.COM]: This can be anything you want, 
       	       	       	    		       except it cannot conflict with
					       another kerberos server on the
					       same network

Directory Manager password: 
Password (confirm): 

IPA admin password: 
Password (confirm): 

The above two passwords will be important; it is best to make them the
same password, and to make sure you remember that password for later.

4)  Assuming that your ipa-server-install went well, we can now generate
some of the principals you will need.  From the /root directory on the
appliance, run:

# ./create_default_principals.py

5)  For now, you'll need to create principals for each of the Ovirt hosts
that will connect to the WUI.  This will become automated later.  This means
that the Ovirt hosts really need stable DNS entries; the easiest way to do
this is to find out what their MAC address is and add a "fixed-address" section
to the dhcpd.conf:

host perf201 {
     fixed-address 192.168.25.78;
     hardware ethernet 00:16:3e:76:45:ea;
}

(remember to restart dhcpd if you change things)

Then for each host you are going to attach, you should run from the /root
directory:

# ./add_host_principal.py perf201.perf.redhat.com

6)  # service ovirt-wui restart

7)  That should be it.  Assuming you have all the above setup properly, it's
best at this point to reboot your appliance to get all of the services running.
