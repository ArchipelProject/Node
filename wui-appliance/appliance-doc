# FIXME: describe all of the other setup you need to do on the host (
KVM modules, bridge setup, etc.)


1.  Create the guest disk:

# qemu-img create -f qcow wui-appliance.dsk 4G

2.  Create some libvirt XML in the file wui-appliance.xml:

<domain type='kvm'>
  <name>wui-appliance</name>
  <uuid>035ee63e-9d0a-b174-ff22-ecd37dc4134a</uuid>
  <memory>512000</memory>
  <currentMemory>512000</currentMemory>
  <vcpu>2</vcpu>
  <os>
    <type>hvm</type>
    <boot dev='cdrom' />
  </os>
  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>destroy</on_crash>
  <devices>
    <emulator>/usr/bin/qemu-kvm</emulator>
    <disk type='file'>
      <source file='/root/wui-appliance.dsk' />
      <target dev='hda'/>
    </disk>
    <disk type='file' device='cdrom'>
      <source file='/mnt/bigpapi/released/F-8/GOLD/Fedora/x86_64/iso/Fedora-8-x86_64-DVD.iso' />
      <target dev='hdc' />
      <readonly />
    </disk>
    <interface type='bridge'>
      <mac address='00:16:3e:08:91:e9'/>
      <source bridge='ovirtbr1'/>
    </interface>
    <input type='mouse' bus='ps2'/>
    <graphics type='vnc' port='-1' listen='0.0.0.0'/>
  </devices>
</domain>

4.  # virsh -c qemu:///system define wui-appliance.xml

5.  # virsh -c qemu:///system start wui-appliance

6.  # virt-viewer -c qemu:///system wui-appliance

7.  Do the install as normal; use the following kickstart either verbatim, or
as a guide as to what packages you should install:

# Kickstart file automatically generated by anaconda.

install
cdrom
lang en_US.UTF-8
keyboard us
network --device eth0 --bootproto dhcp
rootpw  --iscrypted $1$HNOucon/$m69RprODwQn4XjzVUi9TU0
firewall --enabled --port=22:tcp
authconfig --enableshadow --enablemd5
selinux --enforcing
timezone --utc America/New_York
bootloader --location=mbr --driveorder=sda
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#clearpart --all --drives=sda
#part /boot --fstype ext3 --size=200 --ondisk=sda
#part pv.2 --size=0 --grow --ondisk=sda
#volgroup VolGroup00 --pesize=32768 pv.2
#logvol swap --fstype swap --name=LogVol01 --vgname=VolGroup00 --size=496 --grow --maxsize=992
#logvol / --fstype ext3 --name=LogVol00 --vgname=VolGroup00 --size=1024 --grow

%packages
@admin-tools
@editors
@system-tools
@text-internet
@core
@base
@hardware-support
@web-server
@sql-server
@development-libs
@legacy-fonts
@development-tools
radeontool
fuse
pax
imake
-bittorrent
-fetchmail
-slrn
-cadaver
-mutt

8.  System will shut down after install

9.  Edit the wui-appliance XML:


<domain type='kvm'>
  <name>wui-appliance</name>
  <uuid>035ee63e-9d0a-b174-ff22-ecd37dc4134a</uuid>
  <memory>512000</memory>
  <currentMemory>512000</currentMemory>
  <vcpu>2</vcpu>
  <os>
    <type>hvm</type>
    <boot dev='hd' />
  </os>
  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>destroy</on_crash>
  <devices>
    <emulator>/usr/bin/qemu-kvm</emulator>
    <disk type='file'>
      <source file='/root/wui-appliance.dsk' />
      <target dev='hda'/>
    </disk>
    <interface type='bridge'>
      <mac address='00:16:3e:08:91:e9'/>
      <source bridge='ovirtbr1'/>
    </interface>
    <input type='mouse' bus='ps2'/>
    <graphics type='vnc' port='-1' listen='0.0.0.0'/>
  </devices>
</domain>

10.  # virsh -c qemu:///system define wui-appliance.xml

11.  # virsh -c qemu:///system start wui-appliance

12.  # virt-viewer -c qemu:///system wui-appliance

13.  From now on, all of the commands are inside the guest.

14.  # yum install dhcp

15.  # chkconfig ntpd on

16.  # echo "0.fedora.pool.ntp.org" >> /etc/ntp/step-tickers

17.  # service ntpd start

18.  # yum install tftp-server tftp dhclient

19.  # cd /etc/yum.repos.d ; wget http://freeipa.com/downloads/freeipa-f7-x86_64-devel.repo

20.  # yum install ipa-server ipa-admintools

21.  # rpm -e --nodeps mod_auth_kerb

22.  # yum --disablerepo=fedora --disablerepo=updates install mod_auth_kerb

23.  # chkconfig yum-updatesd off
